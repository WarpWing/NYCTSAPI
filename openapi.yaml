openapi: 3.0.3
info:
  title: MTAPI
  description: MTA's real-time subway, LIRR, and MNR feed exposed as a JSON API
  version: 1.0.0
  contact:
    url: https://github.com/jonthornton/MTAPI
servers:
  - url: /
    description: Default server
paths:
  /:
    get:
      summary: API information
      responses:
        '200':
          description: API welcome message
          content:
            application/json:
              schema:
                type: object
                properties:
                  title:
                    type: string
                    example: MTAPI
                  readme:
                    type: string
                    example: Visit https://github.com/jonthornton/MTAPI for more info
  /by-location:
    get:
      summary: Get subway stations by location
      parameters:
        - name: lat
          in: query
          required: true
          schema:
            type: number
            format: float
          description: Latitude coordinate
        - name: lon
          in: query
          required: true
          schema:
            type: number
            format: float
          description: Longitude coordinate
      responses:
        '200':
          description: Stations near the specified location
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StationsEnvelope'
        '400':
          description: Missing lat/lon parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /by-route/{route}:
    get:
      summary: Get stations by route
      parameters:
        - name: route
          in: path
          required: true
          schema:
            type: string
          description: Route identifier (e.g., 4, 5, 6, N, Q, R, W)
      responses:
        '200':
          description: Stations on the specified route
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StationsEnvelope'
        '301':
          description: Redirect to uppercase route
        '404':
          description: Route not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /by-id/{id_string}:
    get:
      summary: Get stations by ID
      parameters:
        - name: id_string
          in: path
          required: true
          schema:
            type: string
          description: Comma-separated station IDs
      responses:
        '200':
          description: Stations with the specified IDs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StationsEnvelope'
        '404':
          description: Station not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /routes:
    get:
      summary: Get all subway routes
      responses:
        '200':
          description: List of all subway routes
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: string
                  updated:
                    type: string
                    format: date-time
  /search:
    get:
      summary: Search subway stations
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
          description: Search query
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/StationSearchResult'
                  updated:
                    type: string
                    format: date-time
        '400':
          description: Missing q parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /lirr/routes:
    get:
      summary: Get all LIRR routes
      responses:
        '200':
          description: List of all LIRR routes
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: string
                  updated:
                    type: string
                    format: date-time
  /lirr/stops:
    get:
      summary: Get all LIRR stops
      responses:
        '200':
          description: List of all LIRR stops
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/RegionalStop'
                  updated:
                    type: string
                    format: date-time
  /lirr/by-route/{route}:
    get:
      summary: Get LIRR stops by route
      parameters:
        - name: route
          in: path
          required: true
          schema:
            type: string
          description: LIRR route identifier
      responses:
        '200':
          description: Stops on the specified LIRR route
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/RegionalStop'
                  updated:
                    type: string
                    format: date-time
        '404':
          description: Route not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /lirr/by-id/{stop_id}:
    get:
      summary: Get LIRR stop by ID
      parameters:
        - name: stop_id
          in: path
          required: true
          schema:
            type: string
          description: LIRR stop ID
      responses:
        '200':
          description: LIRR stop information
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/RegionalStop'
                  updated:
                    type: string
                    format: date-time
        '404':
          description: Stop not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /lirr/search:
    get:
      summary: Search LIRR stops
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
          description: Search query
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/RegionalStopSearchResult'
                  updated:
                    type: string
                    format: date-time
        '400':
          description: Missing q parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /lirr/by-location:
    get:
      summary: Get LIRR stops by location
      parameters:
        - name: lat
          in: query
          required: true
          schema:
            type: number
            format: float
          description: Latitude coordinate
        - name: lon
          in: query
          required: true
          schema:
            type: number
            format: float
          description: Longitude coordinate
      responses:
        '200':
          description: LIRR stops near the specified location
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/RegionalStop'
                  updated:
                    type: string
                    format: date-time
        '400':
          description: Missing lat/lon parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /mnr/routes:
    get:
      summary: Get all MNR routes
      responses:
        '200':
          description: List of all MNR routes
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: string
                  updated:
                    type: string
                    format: date-time
  /mnr/stops:
    get:
      summary: Get all MNR stops
      responses:
        '200':
          description: List of all MNR stops
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/RegionalStop'
                  updated:
                    type: string
                    format: date-time
  /mnr/by-route/{route}:
    get:
      summary: Get MNR stops by route
      parameters:
        - name: route
          in: path
          required: true
          schema:
            type: string
          description: MNR route identifier
      responses:
        '200':
          description: Stops on the specified MNR route
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/RegionalStop'
                  updated:
                    type: string
                    format: date-time
        '404':
          description: Route not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /mnr/by-id/{stop_id}:
    get:
      summary: Get MNR stop by ID
      parameters:
        - name: stop_id
          in: path
          required: true
          schema:
            type: string
          description: MNR stop ID
      responses:
        '200':
          description: MNR stop information
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/RegionalStop'
                  updated:
                    type: string
                    format: date-time
        '404':
          description: Stop not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /mnr/search:
    get:
      summary: Search MNR stops
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
          description: Search query
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/RegionalStopSearchResult'
                  updated:
                    type: string
                    format: date-time
        '400':
          description: Missing q parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /mnr/by-location:
    get:
      summary: Get MNR stops by location
      parameters:
        - name: lat
          in: query
          required: true
          schema:
            type: number
            format: float
          description: Latitude coordinate
        - name: lon
          in: query
          required: true
          schema:
            type: number
            format: float
          description: Longitude coordinate
      responses:
        '200':
          description: MNR stops near the specified location
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/RegionalStop'
                  updated:
                    type: string
                    format: date-time
        '400':
          description: Missing lat/lon parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /outages/search:
    get:
      summary: Search outages by station
      parameters:
        - name: station
          in: query
          required: true
          schema:
            type: string
          description: Station name to search for outages
      responses:
        '200':
          description: Outage information for the station
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OutageResult'
        '400':
          description: Missing station parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /alerts/search:
    get:
      summary: Search alerts
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
          description: Search query
        - name: service
          in: query
          required: false
          schema:
            type: string
            enum: [all, subway, lirr, mnr]
            default: all
          description: Service type filter
      responses:
        '200':
          description: Alert search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlertResult'
        '400':
          description: Missing q parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /route-plan:
    get:
      summary: Basic route planning
      parameters:
        - name: from_lat
          in: query
          required: true
          schema:
            type: number
            format: float
          description: Origin latitude
        - name: from_lon
          in: query
          required: true
          schema:
            type: number
            format: float
          description: Origin longitude
        - name: to_lat
          in: query
          required: true
          schema:
            type: number
            format: float
          description: Destination latitude
        - name: to_lon
          in: query
          required: true
          schema:
            type: number
            format: float
          description: Destination longitude
      responses:
        '200':
          description: Route planning suggestions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoutePlanResult'
        '400':
          description: Missing or invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
components:
  schemas:
    Error:
      type: object
      properties:
        error:
          type: string
    StationsEnvelope:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Station'
        updated:
          type: string
          format: date-time
    Station:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        location:
          type: array
          items:
            type: number
            format: float
          minItems: 2
          maxItems: 2
        stops:
          type: object
          additionalProperties:
            type: array
            items:
              type: number
              format: float
        N:
          type: array
          items:
            $ref: '#/components/schemas/Train'
        S:
          type: array
          items:
            $ref: '#/components/schemas/Train'
        routes:
          type: array
          items:
            type: string
        last_update:
          type: string
          format: date-time
    Train:
      type: object
      properties:
        route:
          type: string
        time:
          type: string
          format: date-time
    StationSearchResult:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        location:
          type: array
          items:
            type: number
            format: float
          minItems: 2
          maxItems: 2
    RegionalStop:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        location:
          type: array
          items:
            type: number
            format: float
          minItems: 2
          maxItems: 2
        url:
          type: string
        code:
          type: string
        wheelchair_boarding:
          type: string
        trains:
          type: object
          properties:
            N:
              type: array
              items:
                $ref: '#/components/schemas/RegionalTrain'
            S:
              type: array
              items:
                $ref: '#/components/schemas/RegionalTrain'
        last_update:
          type: string
          format: date-time
    RegionalTrain:
      type: object
      properties:
        route:
          type: string
        route_name:
          type: string
        time:
          type: string
          format: date-time
        trip_id:
          type: string
        departure_time:
          type: string
          format: date-time
        departure_time_formatted:
          type: string
        arrival_time:
          type: string
          format: date-time
        arrival_time_formatted:
          type: string
        origin_departure:
          type: string
          format: date-time
        origin_departure_formatted:
          type: string
        origin_station:
          type: string
        harlem_departure:
          type: string
          format: date-time
        harlem_departure_formatted:
          type: string
        harlem_station:
          type: string
    RegionalStopSearchResult:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        location:
          type: array
          items:
            type: number
            format: float
          minItems: 2
          maxItems: 2
        code:
          type: string
    OutageResult:
      type: object
      properties:
        station:
          type: string
        current_outages:
          type: array
          items:
            $ref: '#/components/schemas/Outage'
        upcoming_outages:
          type: array
          items:
            $ref: '#/components/schemas/Outage'
        last_updated:
          type: string
          format: date-time
    Outage:
      type: object
      properties:
        equipment:
          type: string
        type:
          type: string
        serving:
          type: string
        outage_date:
          type: string
        estimated_return:
          type: string
        reason:
          type: string
        ada_accessible:
          type: boolean
    AlertResult:
      type: object
      properties:
        query:
          type: string
        service_type:
          type: string
        alerts:
          type: array
          items:
            $ref: '#/components/schemas/Alert'
        last_updated:
          type: string
          format: date-time
    Alert:
      type: object
      properties:
        service:
          type: string
        header:
          type: string
        description:
          type: string
        active_period:
          type: array
          items:
            type: object
        informed_entity:
          type: array
          items:
            type: object
    RoutePlanResult:
      type: object
      properties:
        from_point:
          type: array
          items:
            type: number
            format: float
          minItems: 2
          maxItems: 2
        to_point:
          type: array
          items:
            type: number
            format: float
          minItems: 2
          maxItems: 2
        options:
          type: object
          properties:
            subway:
              $ref: '#/components/schemas/RouteOption'
            lirr:
              $ref: '#/components/schemas/RouteOption'
            mnr:
              $ref: '#/components/schemas/RouteOption'
        note:
          type: string
    RouteOption:
      type: object
      properties:
        from_stations:
          type: array
          items:
            $ref: '#/components/schemas/Station'
        to_stations:
          type: array
          items:
            $ref: '#/components/schemas/Station'